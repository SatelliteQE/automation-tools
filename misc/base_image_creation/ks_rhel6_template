# Kickstart file automatically generated by anaconda.
#version=DEVEL
install
url --url=OS_URL
lang en_US.UTF-8
keyboard us
network --onboot yes --device eth0 --bootproto dhcp --noipv6
rootpw  --iscrypted ENCRYPT_PASS
firewall --service=ssh
authconfig --enableshadow --passalgo=sha512
selinux --enforcing
timezone America/New_York 
bootloader --location=mbr --driveorder=vda --append="crashkernel=auto rhgb quiet"
# The following is the partition information you requested
# Note that any partitions you deleted are not expressed
# here so unless you clear all partitions first, this is
# not guaranteed to work
zerombr
clearpart --all

# No need to resize after the Os Install, Whatever be the disk size everything resides on /
part /boot --fstype=ext4 --size=500
part pv.253002 --grow --size=1
volgroup vg_dhcp201 --pesize=4096 pv.253002
logvol swap --name=lv_swap --vgname=vg_dhcp201 --grow --size=5984 --maxsize=5984
logvol / --fstype=ext4 --name=lv_root --vgname=vg_dhcp201 --grow --size=1024


repo --name="Red Hat Enterprise Linux"  --baseurl=OS_URL --cost=100

%packages
@base
@core
wget
yum-utils
avahi-tools
avahi
%end

%post --logfile /dev/console

cat <<EOL > /etc/yum.repos.d/rhel6.repo
[rhel6]
name=rhel6
baseurl=OS_URL
enabled=0
gpgcheck=0
EOL

echo "[ ! -f /var/log/configure_rhel6-base_image.log ] && touch /var/log/configure_rhel6-base_image.log" >> /etc/rc.local
echo "[ -f /root/setup_configured ] && echo exiting && exit >> /var/log/configure_rhel6-base_image.log 2>&1" >> /etc/rc.local 
echo "/etc/init.d/ntpd stop >> /var/log/configure_rhel6-base_image.log 2>&1" >> /etc/rc.local
echo "ntpdate clock.redhat.com >> /var/log/configure_rhel6-base_image.log 2>&1" >> /etc/rc.local
echo "iptables -F ; service iptables save ; chkconfig iptables off >> /var/log/configure_rhel6-base_image.log 2>&1" >> /etc/rc.local
echo "service avahi-daemon start ; chkconfig avahi-daemon on  >> /var/log/configure_rhel6-base_image.log 2>&1" >> /etc/rc.local
echo "ssh-keygen -t rsa -N \"\" -f /root/.ssh/id_dsa >> /var/log/configure_rhel6-base_image.log 2>&1" >> /etc/rc.local
echo "wget -O ~/.ssh/authorized_keys AUTH_KEYS_URL >> /var/log/configure_rhel6-base_image.log 2>&1" >> /etc/rc.local
echo "touch /root/setup_configured >> /var/log/configure_rhel6-base_image.log 2>&1" >> /etc/rc.local

%end

reboot
